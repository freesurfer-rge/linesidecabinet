# Steps template for doing a CMake build

parameters:
  srcDir: ''
  bldDir: ''
  cmakeArgs: '-DBoost_DEBUG=ON -DBoost_ARCHITECTURE=-x64'
  cmakeExtraArgs: ''
  makeExtraArgs: ''
  makeTarget: ''

steps:
- script: sudo updatedb
  displayName: "Enable locate"

- script: locate libboost_filesystem
  displayName: "Find boost"
  
- task: Bash@3
  displayName: "Install xerces library"
  inputs:
    filePath: scripts/xerces-install.sh
    
- script: mkdir -p ${{ parameters.bldDir }}
  displayName: 'Create build directory'
    
- script: cmake ${{ parameters.srcDir }} ${{ parameters.cmakeExtraArgs }} ${{ parameters.cmakeArgs }}
  displayName: "Run CMake"
  workingDirectory: ${{ parameters.bldDir }}

- script: make -j VERBOSE=1 ${{ parameters.makeExtraArgs }} ${{ parameters.makeTarget }}
  workingDirectory: ${{ parameters.bldDir }}
  ${{ if eq(parameters.makeTarget, '') }}:
    displayName: "Build default target"
  ${{ if ne(parameters.makeTarget, '') }}:
    displayName: "Build target: ${{ parameters.makeTarget }}"

  